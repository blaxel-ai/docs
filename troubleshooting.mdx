---
title: "Troubleshooting"
description: "Troubleshoot common problems with Blaxel deployments"
---

This page describes common issues and how to troubleshoot them.

## Preview URLs return a `502 Bad Gateway` server error

This error occurs when the server running inside the sandbox is binding to `localhost`. As a result, it is only reachable inside the sandbox; the external preview URL will not be able to access it.

To resolve this error, configure your server to bind to IP address `0.0.0.0`, so that it listens on all available network interfaces. To avoid IPv4/IPv6 compatibility issues, we recommend using the environment variable `HOST` instead of setting the address to a static value.

For example, in code:

<CodeGroup>
```tsx TypeScript
const host = process.env.HOST || '0.0.0.0';
app.listen(3000, host, () => {
  console.log(`Server is running`);
});
```

```python Python
host = os.environ.get("HOST", "0.0.0.0")
app.run(host=host, port=3000)
```
</CodeGroup>

or at the command line:

<CodeGroup>
```tsx TypeScript
npm run dev -- --host 0.0.0.0
# or
npm serve -- --host 0.0.0.0
```

```python Python
python main.py --host 0.0.0.0
```
</CodeGroup>

## Deployment fails with `STARTUP TCP probe failed` or `DEADLINE_EXCEEDED` error

This error occurs when the server running inside the sandbox is not binding to the correct host and port.

To resolve this error, configure your server to bind to the host and port designated by the `HOST` and `PORT` environment variables. Blaxel automatically injects these variables during deployment.

For example:

<CodeGroup>
```tsx TypeScript
const port = parseInt(env.PORT || "80");
const host = process.env.HOST || "0.0.0.0";
app.listen(port, host, () => {
  console.log(`Server is running`);
});
```

```python Python
port = os.environ.get("PORT", "80")
host = os.environ.get("HOST", "0.0.0.0")
app.run(host=host, port=port)
```
</CodeGroup>

## Models return a 429 error

This error occurs when a model reaches its maximum token limit.

To resolve this error, adjust the model's token usage policy. Token usage policies control the maximum number of tokens your model APIs can handle within a specific time period. You can configure the maximum number of input tokens, output tokens and/or total tokens using these policies.

## Sandbox commands return a `502 Bad Gateway` error

This error occurs when the sandbox API is unexpectedly terminated - for example, if the sandbox runs out of memory.

To resolve this error, restart the sandbox, which also restarts the sandbox API.

<Note>
Restarting will cause the current state of the sandbox to be lost.
</Note>

An alternative approach is to use process supervision ([Supervisor](https://supervisord.org)) inside the sandbox to enable auto-restarts of the sandbox API. To do this, follow the steps below:

1. Add `supervisor` to your Dockerfile's `apt-get install`:

    ```
    RUN apt-get update && apt-get install -y \
        ... \
        supervisor \
        && apt-get clean && rm -rf /var/lib/apt/lists/*
    ```

1. Create a config file named `supervisord.conf`:

    ```
    [supervisord]
    nodaemon=true
    logfile=/var/log/supervisord.log
    pidfile=/var/run/supervisord.pid
    loglevel=info

    [program:sandbox-api]
    command=/usr/local/bin/sandbox-api
    directory=/home/user
    autostart=true
    autorestart=true
    startsecs=2
    startretries=9999
    ; Restart aggressively on any exit (including OOM kill)
    exitcodes=0
    ; Priority ensures sandbox-api starts first
    priority=100
    stdout_logfile=/var/log/sandbox-api.log
    stderr_logfile=/var/log/sandbox-api-error.log
    stdout_logfile_maxbytes=10MB
    stderr_logfile_maxbytes=10MB
    ```

1. Copy the configuration file to your container image:

    ```
    COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf
    ```

1. Update your entrypoint script to use `supervisord`, which will start and monitor the sandbox API:

    ```shell
    exec /usr/bin/supervisord -c /etc/supervisor/conf.d/supervisord.conf
    ```

This approach ensures the sandbox API automatically restarts if it runs out of memory or crashes unexpectedly.

## Sandbox commands return a `ENOSPC: no space left on device` error

This error occurs when your sandbox runs out of storage space. This usually happens when your file storage requirements exceed the available memory since, for performance reasons, Blaxel sandboxes reserve, when possible, [approximately 50% of their available memory](/Sandboxes/Overview#memory-and-filesystem) for the filesystem.

To resolve this error, increase the available memory allocation for the sandbox, or add storage using [volumes](/Sandboxes/Volumes). Adding storage requires deleting and recreating the sandbox first.

## Volume creation fails with an error

This error occurs when a volume is smaller than the template data, or when the workspace quota limit is breached.

To resolve this error, you can:
- Provision extra space for your volume beyond the template content size. We recommend provisioning at least 20-30% extra space.
- Contact us to increase your workspace quota limit.

## Hot reloads fail on Webpack previews

This error occurs when a Webpack server is configured to use the same port as local development, but the sandbox preview URL is mapped to a different port. As a result, when hot reloading previews, your client is trying to connect to the local development port instead of the sandbox's preview URL port.

To resolve this error, add a conditional in the `webSocketURL` of your `webpack/config.dev.js` to handle the different ports:

```javascript highlight={9-13}
///... rest of webpack/config.dev.js

module.exports = {
  devServer: {
    host: "::",
    port: 3000,
    allowedHosts: [".bl.run", ".beamlit.net", "localhost", "127.0.0.1"],
    client: {
      webSocketURL: {
        port: process.env.BL_CLOUD === "true" ? 443 : 3000,
      },
    },
    headers: {
      ...
    },
  },
  /// ... rest of webpack/config.dev.js
```
